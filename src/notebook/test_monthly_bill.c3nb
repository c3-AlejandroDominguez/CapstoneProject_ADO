{"cells":[{"kind":1,"languageId":"markdown","value":"# Testing SmartBulb monthlyBill and remainingLifespanInHours Functions\n\nThis notebook demonstrates step-by-step how the monthlyBill and remainingLifespanInHours functions work.","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 1: Fetch a SmartBulb to test with\n    var bulb = SmartBulb.forId(\"SMBLB10000\")\nbulb.id\n// print(\"Bulb type: \" + bulb.type());\n// print(\"Manufacturer: \" + bulb.manufacturer);\n// print(\"Wattage: \" + bulb.wattage);","output":[{"items":[{"mime":"text/plain","value":["SMBLB10000"]}]}],"executionSummary":{"timing":{"startTime":1771017799278,"endTime":1771017826581},"executionOrder":1,"success":true}},{"kind":2,"languageId":"javascript","value":"// Step 2: Check bulb-specific properties\n// print(\"Efficiency Factor: \" + (bulb.efficiencyFactor || \"not set\"));\n// print(\"Lifespan in Hours: \" + (bulb.lifeSpanInHours || \"not set\"));\n// print(\"Electricity Rate: \" + (bulb.electricityRate || \"not set\"));\nbulb.this","output":[],"executionSummary":{"executionOrder":5}},{"kind":2,"languageId":"javascript","value":"// Step 3: Get all measurement series for this bulb\nvar seriesList = SmartBulbMeasurementSeries.fetch({\n    filter: Filter.eq('smartBulb.id', bulb.id),\n    limit: -1\n});\n\nseriesList","output":[{"items":[{"mime":"application/vnd.code.notebook.error","value":{"name":"","message":"","stack":"\u001b[31m---------------------------------------------------------------------------\u001b[0m\n\u001b[31mTypeError\u001b[0m: Cannot redefine property: $loaded\n    at Object.defineProperty (<anonymous>)\n    at setup (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/bootstrap.js-client-node.js?tier=FULL:87249:8)\n    at loadedType (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/bootstrap.js-client-node.js?tier=FULL:87355:1)\n    at Object.get (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/bootstrap.js-client-node.js?tier=FULL:87375:1)\n    at _make (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/bootstrap.js-client-node.js?tier=FULL:87718:24)\n    at b.$makeField (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/bootstrap.js-client-node.js?tier=FULL:87299:8)\n    at eval (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/SmartBulbMeasurementSeries.js-client-node.js?tier=FULL&bootstrapped&x=ImplLanguage&x=ImplLanguage.Session&x=Identified&x=Identifiable&x=Js.TurboJsSession&x=DslComment&x=DeclaredReferenceType&x=ReferenceType&x=ValueType&x=DeclaredFieldType&x=InheritedValueType&x=MethodType&x=FunctionType&x=DateTimeType&x=PrimitiveType&x=StringType&x=NativeType&x=Action.Requirement&x=ImplLanguage.Session.SetupSpec&x=FieldType&x=FieldTypeAndMethodBase&x=Str&x=Annotations&x=Ann&x=Val&x=BooleanType&x=FunctionParam&x=VarReferenceType&x=LambdaType&x=Pkg&x=AppMode&x=Enum&x=Enum%3Cstring%3E&x=ArrayType&x=CollectionType&x=Boxed&x=Boxed%3Cstring%3E&x=Ann.Ser&x=Annotation&x=MapType&x=AnyType&x=ImplLanguage.Session.ExecuteResult&x=IntType&x=NumberType&x=Content&x=ContentMeta&x=ContentTypeInfo&x=ContentValue&x=ReadOnlyContent&x=Base64&x=Notebook&x=Notebook.Output&x=Notebook.Output.Kind&x=FetchResult&x=FetchResult%3Cmixing%20SmartBulbMeasurementSeries%3E&x=DataGriddable&x=Refreshable:23209:17)\n    at Array.forEach (<anonymous>)\n    at $Builder.build (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/SmartBulbMeasurementSeries.js-client-node.js?tier=FULL&bootstrapped&x=ImplLanguage&x=ImplLanguage.Session&x=Identified&x=Identifiable&x=Js.TurboJsSession&x=DslComment&x=DeclaredReferenceType&x=ReferenceType&x=ValueType&x=DeclaredFieldType&x=InheritedValueType&x=MethodType&x=FunctionType&x=DateTimeType&x=PrimitiveType&x=StringType&x=NativeType&x=Action.Requirement&x=ImplLanguage.Session.SetupSpec&x=FieldType&x=FieldTypeAndMethodBase&x=Str&x=Annotations&x=Ann&x=Val&x=BooleanType&x=FunctionParam&x=VarReferenceType&x=LambdaType&x=Pkg&x=AppMode&x=Enum&x=Enum%3Cstring%3E&x=ArrayType&x=CollectionType&x=Boxed&x=Boxed%3Cstring%3E&x=Ann.Ser&x=Annotation&x=MapType&x=AnyType&x=ImplLanguage.Session.ExecuteResult&x=IntType&x=NumberType&x=Content&x=ContentMeta&x=ContentTypeInfo&x=ContentValue&x=ReadOnlyContent&x=Base64&x=Notebook&x=Notebook.Output&x=Notebook.Output.Kind&x=FetchResult&x=FetchResult%3Cmixing%20SmartBulbMeasurementSeries%3E&x=DataGriddable&x=Refreshable:23206:27)\n    at Proxy._instantiate (https://c3azcs.c3.ai/aledominort/capstoneproject/typesys/8/SmartBulbMeasurementSeries.js-client-node.js?tier=FULL&bootstrapped&x=ImplLanguage&x=ImplLanguage.Session&x=Identified&x=Identifiable&x=Js.TurboJsSession&x=DslComment&x=DeclaredReferenceType&x=ReferenceType&x=ValueType&x=DeclaredFieldType&x=InheritedValueType&x=MethodType&x=FunctionType&x=DateTimeType&x=PrimitiveType&x=StringType&x=NativeType&x=Action.Requirement&x=ImplLanguage.Session.SetupSpec&x=FieldType&x=FieldTypeAndMethodBase&x=Str&x=Annotations&x=Ann&x=Val&x=BooleanType&x=FunctionParam&x=VarReferenceType&x=LambdaType&x=Pkg&x=AppMode&x=Enum&x=Enum%3Cstring%3E&x=ArrayType&x=CollectionType&x=Boxed&x=Boxed%3Cstring%3E&x=Ann.Ser&x=Annotation&x=MapType&x=AnyType&x=ImplLanguage.Session.ExecuteResult&x=IntType&x=NumberType&x=Content&x=ContentMeta&x=ContentTypeInfo&x=ContentValue&x=ReadOnlyContent&x=Base64&x=Notebook&x=Notebook.Output&x=Notebook.Output.Kind&x=FetchResult&x=FetchResult%3Cmixing%20SmartBulbMeasurementSeries%3E&x=DataGriddable&x=Refreshable:23453:29)"}}]}],"executionSummary":{"timing":{"startTime":1771017855696,"endTime":1771017962570},"executionOrder":2,"success":false}},{"kind":2,"languageId":"javascript","value":"// Step 4: Set up the month to test (February 2026)\nvar month = 2;\nvar year = 2026;\n\nvar startOfMonth = DateTime.parse(year + \"-\" + (month < 10 ? \"0\" : \"\") + month + \"-01T00:00:00Z\", \"yyyy-MM-dd'T'HH:mm:ss'Z'\");\nvar nextMonth = month + 1;\nvar endOfMonth = DateTime.parse(year + \"-\" + (nextMonth < 10 ? \"0\" : \"\") + nextMonth + \"-01T00:00:00Z\", \"yyyy-MM-dd'T'HH:mm:ss'Z'\");\n\nprint(\"Testing month: \" + month + \"/\" + year);\nprint(\"Start of month: \" + startOfMonth);\nprint(\"End of month: \" + endOfMonth);","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 5: Get measurements for the first series in the test month\nif (seriesList.objs.length > 0) {\n    var firstSeries = seriesList.objs[0];\n    \n    var measurements = SmartBulbMeasurement.fetch({\n        filter: Filter.eq('parent', firstSeries.id)\n            .and(Filter.ge('start', startOfMonth))\n            .and(Filter.lt('start', endOfMonth)),\n        limit: 10  // Just show first 10\n    });\n    \n    print(\"\\nMeasurements in \" + month + \"/\" + year + \" for series \" + firstSeries.id + \": \" + measurements.count());\n    \n    if (measurements.objs.length > 0) {\n        print(\"\\nFirst 3 measurements:\");\n        for (var i = 0; i < Math.min(3, measurements.objs.length); i++) {\n            var m = measurements.objs[i];\n            print(\"  - Start: \" + m.start + \", Power: \" + m.power + \"W\");\n        }\n    }\n}","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 6: Calculate energy consumption manually for all measurements\nvar totalKwh = 0.0;\nvar totalMeasurements = 0;\nvar efficiencyFactor = bulb.efficiencyFactor || 1.0;\n\nfor (var i = 0; i < seriesList.objs.length; i++) {\n    var series = seriesList.objs[i];\n    \n    var measurements = SmartBulbMeasurement.fetch({\n        filter: Filter.eq('parent', series.id)\n            .and(Filter.ge('start', startOfMonth))\n            .and(Filter.lt('start', endOfMonth))\n    });\n    \n    for (var j = 0; j < measurements.objs.length; j++) {\n        var measurement = measurements.objs[j];\n        // Energy (kWh) = (power_watts × 0.5_hours) / 1000 × efficiency_factor\n        var energyKwh = (measurement.power * 0.5 / 1000.0) * efficiencyFactor;\n        totalKwh += energyKwh;\n        totalMeasurements++;\n    }\n}\n\nprint(\"\\n=== Manual Calculation ===\");\nprint(\"Total measurements in \" + month + \"/\" + year + \": \" + totalMeasurements);\nprint(\"Efficiency factor: \" + efficiencyFactor);\nprint(\"Total energy consumed: \" + totalKwh.toFixed(4) + \" kWh\");\nprint(\"Electricity rate: $\" + (bulb.electricityRate || 0) + \"/kWh\");\nprint(\"Expected bill: $\" + (totalKwh * (bulb.electricityRate || 0)).toFixed(2));","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 7: Call the actual monthlyBill function\nvar actualBill = bulb.monthlyBill(month, year);\nprint(\"\\n=== Actual Function Result ===\");\nprint(\"monthlyBill(\" + month + \", \" + year + \"): $\" + actualBill);","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"---\n## Testing remainingLifespanInHours Function","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 8: Calculate total hours used manually\nvar totalHoursUsed = 0.0;\nvar totalMeasurementsAllTime = 0;\n\nfor (var i = 0; i < seriesList.objs.length; i++) {\n    var series = seriesList.objs[i];\n    \n    var allMeasurements = SmartBulbMeasurement.fetch({\n        filter: Filter.eq('parent', series.id)\n    });\n    \n    totalMeasurementsAllTime += allMeasurements.count();\n    // Each measurement is exactly 0.5 hours\n    totalHoursUsed += allMeasurements.count() * 0.5;\n}\n\nvar originalLifespan = bulb.lifeSpanInHours || 10000;\nvar remainingManual = originalLifespan - totalHoursUsed;\n\nprint(\"\\n=== Manual Calculation ===\");\nprint(\"Original lifespan: \" + originalLifespan + \" hours\");\nprint(\"Total measurements (all time): \" + totalMeasurementsAllTime);\nprint(\"Total hours used: \" + totalHoursUsed.toFixed(2) + \" hours\");\nprint(\"Remaining lifespan: \" + Math.round(remainingManual) + \" hours\");","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 9: Call the actual remainingLifespanInHours function\nvar actualRemaining = bulb.remainingLifespanInHours();\nprint(\"\\n=== Actual Function Result ===\");\nprint(\"remainingLifespanInHours(): \" + actualRemaining + \" hours\");","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"---\n## Test with Different Bulb Types","output":[],"executionSummary":{}},{"kind":2,"languageId":"javascript","value":"// Step 10: Compare results for different bulb types\nvar ledBulbs = LEDBulb.fetch({limit: 1});\nvar cflBulbs = CFLBulb.fetch({limit: 1});\nvar incanBulbs = INCANBulb.fetch({limit: 1});\n\nprint(\"\\n=== Testing Different Bulb Types ===\");\n\nif (ledBulbs.objs.length > 0) {\n    var led = ledBulbs.objs[0];\n    print(\"\\nLED Bulb (\" + led.id + \"):\");\n    print(\"  Efficiency Factor: \" + led.efficiencyFactor);\n    print(\"  Lifespan: \" + led.lifeSpanInHours + \" hours\");\n    print(\"  Monthly Bill: $\" + led.monthlyBill(month, year));\n}\n\nif (cflBulbs.objs.length > 0) {\n    var cfl = cflBulbs.objs[0];\n    print(\"\\nCFL Bulb (\" + cfl.id + \"):\");\n    print(\"  Efficiency Factor: \" + cfl.efficiencyFactor);\n    print(\"  Lifespan: \" + cfl.lifeSpanInHours + \" hours\");\n    print(\"  Monthly Bill: $\" + cfl.monthlyBill(month, year));\n}\n\nif (incanBulbs.objs.length > 0) {\n    var incan = incanBulbs.objs[0];\n    print(\"\\nIncandescent Bulb (\" + incan.id + \"):\");\n    print(\"  Efficiency Factor: \" + incan.efficiencyFactor);\n    print(\"  Lifespan: \" + incan.lifeSpanInHours + \" hours\");\n    print(\"  Monthly Bill: $\" + incan.monthlyBill(month, year));\n}","output":[],"executionSummary":{}}],"metadata":{"id":"fae2b02f-1380-415a-96e1-13e58364e187","appName":"capstoneproject","serializerVersion":"1","runtime":"js-rhino"}}